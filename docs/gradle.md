# Про сборку проекта на gradle

### Общая структура
Это относительно новая для меня область, я до этого gradle практически не трогала. Пока поверим тому, что сгенерил Android Studio и объяснил GPT. 


#### Структура файлов

Основные файлы и папки:

```
project-root/
├── app/                   <-- модуль приложения
│   ├── build.gradle
│   └── ...
├── build.gradle           <-- главный build-скрипт
├── settings.gradle
└── gradle/
```

- `settings.gradle` — указывает, какие модули входят в проект (например, include ':app').
- `build.gradle` (в корне) — основной файл с настройками для всего проекта.
- `app/build.gradle` — настройки конкретного модуля приложения (чаще всего собираешь APK именно отсюда).
- `gradle/` — служебные скрипты для запуска gradle.

#### Структура файла build.gradle

**Основные секции:**

Порядок не важен, но лучше читается, если именно так

- `plugins` — подключение плагинов (например, android, kotlin). Отличаются от зависимостей тем, что меняют настройки gradle, добавляют задачи в сборку
- `android`,`kotlin` или `application` — kotlin/gradle настройки для сборки приложения
- `repositories` – откуда брать зависимости: maven, google
- `dependencies` – какие зависимости, сторонние библиотеки. Внутри они могут быть разные:
  - `implementation` означает, что библиотека нужна коду, но не экспортируется наружу
  - `api` - экспортируется
  - могут быть также и кастомные, например `ksp` для генераторов кода, чтобы библиотека использовалась во время генерации
- `tasks` – дополнительные задачи или конфигурации, если в плагинах чего-то не хватило

#### Структура libs.versions.toml
В `gradle/libs.versions.toml` указаны версии всех библиотек. 
Тут тоже несколько секций:
- `[versions]` – все версии в одном месте
- `[libraries]` – зависимости (ссылки на версии через version.ref)
- `[plugins]` – версии плагинов
- (опционально) `[bundles]` – группировка зависимостей

Нужно быть внимательными с версией kotlin и compose, а также room, gradle - они должны сочетаться друг с другом

#### Как запускать сборку

**Стандартные команды через terminal:**

`./gradlew` — это gradle wrapper: проект запускается с конкретной, нужной версией Gradle, которая гарантированно подходит для этого проекта.

- Собрать APK для debug:
  ```
  ./gradlew assembleDebug
  ```
  Здесь assembleDebug - это не пользовательская команда, а задача, автоматически создаваемая Android Gradle Plugin. Она формируется на основе секции buildTypes (debug, release) внутри блока android в файле build.gradle. Т.е. если в android { buildTypes { ... } } есть debug, Gradle сам создает задачу assembleDebug. Описывать её отдельно не нужно.
- Собрать APK для release:
  ```
  ./gradlew assembleRelease
  ```
- Запустить приложение на устройстве:
  ```
  ./gradlew installDebug
  ```
- Очистить старые билды:
  ```
  ./gradlew clean
  ```
- Запустить тесты:
  ```
  ./gradlew test
  ```
